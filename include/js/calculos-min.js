function getCustomizedPerfilMensal(a,e){return a>=0&&a<3?e>=4&&e<9?0==a?1:2==a?1:1==a?perfil_mensal[a].consumo:0:0==a?1:2==a?perfil_mensal[a].consumo:1==a?1:0:new Number($("#perfil-mensal-input"+(e+1)).val())/100}function getCustomizedPerfilSemanal(a){var e=0;if(3==a){var o=0;for(k=1;k<8;k++)o+=new Number($("#perfil-semanal-input"+k).val());e=o/7/100}return e}function totalNecessidadesEnergiaFunction(){var a=new Number($("#perfil-mensal").val()),e=new Number($("#perfil-semanal").val()),o=(new Number($("#temp-req").val()),new Number($("#distrito").val())),r=$("#consumo-energia").val(),t=$("#sis-prod").val();necessidades_mes=[],totalNecessidadesEnergia=0,total=0;var n=$("#conhece-consumo").val();if(""!=n&&null!=n&&0==n&&0==r)for(i=0;i<meses_numero_horas.length;i++)necessidades_mes[i]=new Number($("input[name='consumoAnualTotal']").val()*meses_numero_horas[i].aqs_mensal*tecnologia_atual[t].fator_conversao),totalNecessidadesEnergia+=new Number(necessidades_mes[i]);else if(""!=n&&null!=n&&0==n&&1==r)for(i=0;i<meses_numero_horas.length;i++)necessidades_mes[i]=new Number($("input[name='consumosMeses["+i+"]']").val()*tecnologia_atual[t].fator_conversao),totalNecessidadesEnergia+=new Number(necessidades_mes[i]);else if(""!=n&&null!=n&&1==n){var s=0;for(j=1;j<rowId+1;j++){var l=new Number($("#tipo-consumo-value"+j).val()),c=$("#tipo-consumo"+j).val();s+=l*consumo_diario_agua[c].valor}for(i=0;i<meses_numero_horas.length;i++)necessidades_mes[i]=s*getCustomizedPerfilMensal(a,i)*(0==e?perfil_semanal[e].valor:1==e?perfil_semanal[e].valor:3==e?new Number(getCustomizedPerfilSemanal(e)/7):1)*meses_numero_horas[i].n_dias*(temperatura_utilizacao-irradiacao_temp_amb_temp_agua[o].mesI[i].valorTempAgua)*fatores_conversao[0],totalNecessidadesEnergia+=necessidades_mes[i]}total=totalNecessidadesEnergia,correcaoOrientacao(),energiaSolarCaptada()}function correcaoOrientacao(){var a=$("#orientacao-solar").val(),e=0,o=0;""!=(o=""!=a&&null!=a&&a<0?-1*a:a)&&null!=o&&(e=o>70?0:o>0?1.14-.0085*a:1),totalCorrecaoOrientacao=e}function getCorrecaoInclinacao(a,e){for(j=0;j<correcao_inclinacao.length;j++)if(a==correcao_inclinacao[j].latitude)return correcao_inclinacao[j].meses[e].valor}function energiaSolarCaptada(){var a=new Number($("#distrito").val()),e=new Number($("#distrito-latitude").val());for(totalEnergiaArray=[],totalEnergia=0,i=0;i<meses_numero_horas.length;i++)totalEnergiaArray[i]=(rendimento_otico*perdas[1].valor-coeficient_perdas*((temperatura_utilizacao-(irradiacao_temp_amb_temp_agua[a].mesI[i].valorTempAmb+irradiacao_temp_amb_temp_agua[a].mesI[i].valorTempAgua))/(getCorrecaoInclinacao(e,i)*(totalCorrecaoOrientacao*perdas[2].valor*irradiacao_temp_amb_temp_agua[a].mesI[i].valorIrr)*(1e3*fatores_conversao[1]/meses_numero_horas[i].n_horas_sol))))*(getCorrecaoInclinacao(e,i)*(totalCorrecaoOrientacao*perdas[2].valor*irradiacao_temp_amb_temp_agua[a].mesI[i].valorIrr))*(1-perdas[0].valor)*meses_numero_horas[i].n_dias,totalEnergia+=totalEnergiaArray[i];racio(),energiaSolarCaptada2(),energiaSolarUtilizada(),energiaSolarUtilizadaPercent(),energiaBackup(),energiaBackupPercent(),excedenteSolar(),excedenteSolarPerc(),necessidadesEnergeticaskWh(),cenarioI(),cenarioF(),reduction(),1==resume()&&nextStep()}function racio(){totalRacio=new Number(media(necessidades_mes)/media(totalEnergiaArray))}function media(a){var e=0;for(i=0;i<a.length;i++)i>=4&&i<9&&(e+=new Number(a[i]));return e/5}function energiaSolarCaptada2(){var a=""==$("#corrige-coletores").val()||null==$("#corrige-coletores").val()?0==new Number(totalRacio/area_coletor_solar)?1:new Number(totalRacio/area_coletor_solar).toFixed(0):$("#corrige-coletores").val(),e=""!=$("#corrige-coletores").val()&&null!=$("#corrige-coletores").val()?$("#corrige-coletores").val():a;for(totalEnergiaArray2=[],totalEnergia2=0,i=0;i<meses_numero_horas.length;i++)totalEnergiaArray2[i]=totalEnergiaArray[i]*e*2.25,totalEnergia2+=totalEnergiaArray2[i]}function energiaSolarUtilizada(){for(totalEnergiaSolarUtilizada=[],totalEnergiaSolar=0,i=0;i<meses_numero_horas.length;i++)totalEnergiaArray2[i]>necessidades_mes[i]?totalEnergiaSolarUtilizada[i]=necessidades_mes[i]:totalEnergiaSolarUtilizada[i]=totalEnergiaArray2[i],totalEnergiaSolar+=totalEnergiaSolarUtilizada[i]}function energiaSolarUtilizadaPercent(){for(totalEnergiaSolarUtilizadaPerc=[],totalEnergiaSolarPerc=0,i=0;i<meses_numero_horas.length;i++)totalEnergiaSolarUtilizadaPerc[i]=totalEnergiaSolarUtilizada[i]/necessidades_mes[i];totalEnergiaSolarPerc=totalEnergiaSolar/total}function energiaBackup(){var a=$("#nova-fonte").val(),e=""!=$("#rendimento-medidas").val()&&$("#rendimento-medidas").val()>0?$("#rendimento-medidas").val():tecnologia_futura[a].rendimento;for(totalEnergiaBackupMes=[],totalEnergiaBackup=0,i=0;i<meses_numero_horas.length;i++)necessidades_mes[i]-totalEnergiaArray2[i]<0?totalEnergiaBackupMes[i]=0:totalEnergiaBackupMes[i]=(necessidades_mes[i]-totalEnergiaArray2[i])/(e/100),totalEnergiaBackup+=totalEnergiaBackupMes[i]}function energiaBackupPercent(){for(totalEnergiaBackupMesPerc=[],totalEnergiaBackupPerc=0,i=0;i<meses_numero_horas.length;i++)totalEnergiaBackupMesPerc[i]=totalEnergiaBackupMes[i]/necessidades_mes[i];totalEnergiaBackupPerc=totalEnergiaBackup/total}function excedenteSolar(){for(totalExcedenteSolarArray=[],totalExcedenteSolar=0,i=0;i<meses_numero_horas.length;i++)totalExcedenteSolarArray[i]=totalEnergiaArray2[i]-totalEnergiaSolarUtilizada[i],totalExcedenteSolar+=totalExcedenteSolarArray[i]}function excedenteSolarPerc(){for(totalExcedenteSolarArrayPerc=[],totalExcedenteSolarPerc=0,i=0;i<meses_numero_horas.length;i++)totalExcedenteSolarArrayPerc[i]=totalExcedenteSolarArray[i]/totalEnergiaArray2[i];totalExcedenteSolarPerc=totalExcedenteSolar/totalEnergia2}function necessidadesEnergeticaskWh(){necessidades_mes_kWh=[],total_mes_kWh=0;var a=$("#conhece-consumo").val(),e=$("#consumo-energia").val();for(i=0;i<meses_numero_horas.length;i++)necessidades_mes_kWh[i]=0==a&&1==e?$("input[name='consumosMeses["+i+"]']").val()*tecnologia_atual[$("#sis-prod").val()].fator_conversao:0==a&&0==e?$("input[name='consumoAnualTotal']").val()*tecnologia_atual[$("#sis-prod").val()].fator_conversao*meses_numero_horas[i].aqs_mensal:necessidades_mes[i]*fatores_conversao[1],total_mes_kWh+=necessidades_mes_kWh[i]}function cenarioI(){var a=$("#sis-prod").val(),e=2==$("#rend").val()?0==a?$("#iRendMan").val():$("#iRendMan").val()/100:$("#rend").val(),o=$("#age").val(),r=$("#custo-unit-input").val(),t=$("#conhece-consumo").val(),n=$("#consumo-energia").val(),s=0;for(cenarioI_mes=[],cenarioI_custos=[],total_cenarioI_mes=0,total_cenarioI_custos=0,i=0;i<meses_numero_horas.length;i++)s=0==t&&1==n?$("input[name='consumosMeses["+i+"]']").val()*tecnologia_atual[$("#sis-prod").val()].fator_conversao:0==t&&0==n?$("input[name='consumoAnualTotal']").val()*tecnologia_atual[$("#sis-prod").val()].fator_conversao*meses_numero_horas[i].aqs_mensal:0==e&&tecnologia_atual[a].rendimento[o].nome==idades[o]?necessidades_mes_kWh[i]/tecnologia_atual[a].rendimento[o].valor:necessidades_mes_kWh[i]/e,cenarioI_mes[i]=s,cenarioI_custos[i]=cenarioI_mes[i]*r/tecnologia_atual[a].fator_conversao,total_cenarioI_mes+=cenarioI_mes[i],total_cenarioI_custos+=cenarioI_custos[i];total_cenarioI_custos=total_cenarioI_custos}function cenarioF(){var a=$("#sis-prod").val(),e=2==$("#rend").val()?0==a?$("#iRendMan").val():$("#iRendMan").val()/100:$("#rend").val(),o=$("#nova-fonte").val(),r=""!=$("#rendimento-medidas").val()&&$("#rendimento-medidas").val()>0?$("#rendimento-medidas").val():tecnologia_futura[o].rendimento,t=$("#age").val(),n=$("#custo-unit-medidas").val(),s=0;cenarioF_mes=[],total_cenarioF_mes=0,cenarioF_custos=[],total_cenarioF_custos=0;var l=0!=e&&""!=e&&e>0&&(""==t||null==t)?e:tecnologia_atual[a].rendimento[t].valor;for(i=0;i<meses_numero_horas.length;i++)s=0==$("#nova-fonte").val()?isNaN(1==$("#acoplar-solar").val()||""==$("#acoplar-solar").val()||null==$("#acoplar-solar").val()?cenarioI_mes[i]*l/r:totalEnergiaBackupMes[i]*fatores_conversao[1]/r)?0:1==$("#acoplar-solar").val()||""==$("#acoplar-solar").val()||null==$("#acoplar-solar").val()?cenarioI_mes[i]*l/r:totalEnergiaBackupMes[i]*fatores_conversao[1]:isNaN(1==$("#acoplar-solar").val()||""==$("#acoplar-solar").val()||null==$("#acoplar-solar").val()?cenarioI_mes[i]*l/(r/100):totalEnergiaBackupMes[i]*fatores_conversao[1]/(r/100))?0:1==$("#acoplar-solar").val()||""==$("#acoplar-solar").val()||null==$("#acoplar-solar").val()?cenarioI_mes[i]*l/(r/100):totalEnergiaBackupMes[i]*fatores_conversao[1],cenarioF_mes[i]=s,total_cenarioF_mes+=cenarioF_mes[i],cenarioF_custos[i]=cenarioF_mes[i]*n/tecnologia_futura[o].fator_conversao,total_cenarioF_custos+=cenarioF_custos[i];total_cenarioF_custos=total_cenarioF_custos}function reduction(){for(reducao_mes=[],total_reducao_mes=0,reducao_consumos=[],total_reducao_consumos=0,i=0;i<meses_numero_horas.length;i++)reducao_mes[i]=cenarioI_custos[i]-cenarioF_custos[i],total_reducao_mes+=reducao_mes[i],reducao_consumos[i]=cenarioI_mes[i]-cenarioF_mes[i],total_reducao_consumos+=reducao_consumos[i]}function resume(){var a,e,o,r,t,i=0,n=0,s=0,l=0,c=0,m=0,u=0,d=0,_=0,g=0,v=0,h=0,p=0,f=$("#nova-fonte").val(),x=$("#corrige-coletores").val(),b=""!=$("#rendimento-medidas").val()&&$("#rendimento-medidas").val()>0?$("#rendimento-medidas").val():tecnologia_futura[f].rendimento;if(1==$("#acoplar-solar").val()&&""!=$("#acoplar-solar").val()&&null!=$("#acoplar-solar").val()?($(".solar-termico-results").attr("style","display:none"),$(".nota-acoplar").html("*O investimento estimado incorpora os custos com equipamentos/tecnologia, com depósitos e/ou acessórios e os respetivos custos de instalação.").show()):($(".solar-termico-results").removeAttr("style"),$(".nota-acoplar").html("*O investimento estimado incorpora os custos com o sistema solar térmico, com equipamentos/tecnologia, com depósitos e/ou acessórios e os respetivos custos de instalação.").show()),i=total_cenarioI_mes,a=total_cenarioI_custos,e=totalEnergiaSolarPerc,n=total_cenarioF_mes,o=total_cenarioF_custos,(s=total_cenarioI_custos-total_cenarioF_custos)<0?($("#errorAQS").html("A implementação da medida selecionada resultará num aumento da fatura energética face à situação actual."),$("#errorAQS").show()):0==s?($("#errorAQS").html("A implementação da medida selecionada não resultará em nenhuma alteração na fatura energética atual."),$("#errorAQS").show()):($("#errorAQS").html(""),$("#errorAQS").hide()),r=s/total_cenarioI_custos,(l=null!=x&&""!=x?new Number(x):new Number((totalRacio/area_coletor_solar).toFixed(0)))<avisos[4].valor)return alert(avisos[4].mensagem),0;c=null==x||""==x?new Number((l*area_coletor_solar).toFixed(0)):new Number((x*area_coletor_solar).toFixed(0));var E=max(necessidades_mes_kWh);t=arred(necessidades_mes_kWh[0]/fatores_conversao[0]/fatores_conversao[1]/meses_numero_horas[E].n_dias/($("#temp-req").val()-temperatura_media),-2),u=c<10?c*investimento[0].info[0].valor:c>100?c*investimento[0].info[2].valor:investimento[0].info[1].valor*c,d=maxValor(cenarioF_mes)/(b/100)/meses_numero_horas[max(cenarioF_mes)].n_dias/2*tecnologia_futura[f].investimento;var C=t<500?t*investimento[1].info[0].valor:t>2e3?t*investimento[1].info[2].valor:t*investimento[1].info[1].valor;return _=$("#sis-prod").val()>=5&&$("#sis-prod").val()<8?C:C/2,g=0==$("#acoplar-solar").val()?(u+d+_)*investimento[2].valor_direto:(d+_)*investimento[2].valor_direto,v=(m=0==$("#acoplar-solar").val()&&""!=$("#acoplar-solar").val()&&null!=$("#acoplar-solar").val()?u+d+_+g:d+_+g)*investimento[3].valor_direto,h=m/s,p=100*maxValor(totalExcedenteSolarArrayPerc),$("#consumoCI").html(i.toFixed(0)+" kWh"),$("#custosCI").html(new Number(a).toFixed(0)+" €"),$("#consumosCF").html(n.toFixed(0)+" kWh"),$("#custosCF").html(new Number(o).toFixed(0)+" €"),$("#contributoSolarTermico").html(new Number(100*e).toFixed(0)+"%"),$("#reducaoValor").html(s.toFixed(0)+" €"),$("#reducaoPercent").html(new Number(100*r).toFixed(0)+"%"),$("#totalExcedenteSolarPerc").html(p.toFixed(0)+"%"),$("#numeroColetores").html(l.toFixed(0)),$("#areaColetores").html(c.toFixed(0)+" m2"),$("#vAcumulacao").html(new Number(t).toFixed(0)+" litros"),$("#investimentoTotal").html(m.toFixed(0)+" €"),$("#custosColectores").html(u.toFixed(0)+" €"),$("#custosEquipamento").html(d.toFixed(0)+" €"),$("#custosDepositos").html(_.toFixed(0)+" €"),$("#custosInstalacao").html(g.toFixed(0)+" €"),$("#custosOpManutencao").html(v.toFixed(0)+" €"),h<0?$("#periodoRetorno").html("-"):$("#periodoRetorno").html(h.toFixed(1)+" anos"),p>40&&null!=p&&""!=p&&l>=1.5?($(".excedente-note").html(avisos[0].mensagem),$(".excedente-note").show()):($(".excedente-note").html(""),$(".excedente-note").hide()),chartData(),1}function max(a){var e=0,o=0;for(i=0;i<a.length;i++)new Number(a[i])>new Number(e)&&(e=a[i],o=i);return o}function maxValor(a){var e=0;for(i=0;i<a.length;i++)new Number(a[i])>new Number(e)&&(e=a[i]);return e}function arred(a,e){var o=0;return-1==e?o=10*Math.round(a/10):-2==e?o=100*Math.round(a/100):-3==e?o=1e3*Math.round(a/1e3):-4==e&&(o=1e4*Math.round(a/1e4)),o}function maxChart(a){var e=0;if(a.length>0)for(var o=0;o<a.length;o++)(a[o]>e||0==e)&&(e=a[o]);return e+=.1*e}function chartData(){var a=document.getElementById("varCustos").getContext("2d"),e=document.getElementById("solarTermC").getContext("2d"),o=[],r=[],t=[],i=[],n=[],s=[];for(let a=0;a<cenarioI_custos.length;a++)o[a]=cenarioI_custos[a].toFixed(0);for(let a=0;a<cenarioF_custos.length;a++)r[a]=cenarioF_custos[a].toFixed(0);for(let a=0;a<totalEnergiaSolarUtilizada.length;a++)t[a]=totalEnergiaSolarUtilizada[a]/3.6,t[a]=new Number(t[a].toFixed(0));for(let a=0;a<totalEnergiaBackupMes.length;a++)i[a]=totalEnergiaBackupMes[a]/3.6,i[a]=new Number(i[a].toFixed(0));for(let a=0;a<totalEnergiaArray2.length;a++)n[a]=totalEnergiaArray2[a]/3.6,n[a]=new Number(n[a].toFixed(0));for(let a=0;a<necessidades_mes.length;a++)s[a]=necessidades_mes[a]/3.6,s[a]=new Number(s[a].toFixed(0));var l=0==$("#acoplar-solar").val(),c=maxChart(cenarioI_custos)>maxChart(cenarioF_custos)?maxChart(cenarioI_custos):maxChart(cenarioF_custos);if(maxChart(t)>maxChart(i)&&maxChart(t)>maxChart(n)&&maxChart(t)>maxChart(s))var m=maxChart(t);else if(maxChart(i)>maxChart(t)&&maxChart(i)>maxChart(n)&&maxChart(i)>maxChart(s))m=maxChart(i);else if(maxChart(n)>maxChart(t)&&maxChart(n)>maxChart(i)&&maxChart(n)>maxChart(s))m=maxChart(n);else m=maxChart(s);new Chart(a,{type:"bar",data:{labels:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],datasets:[{label:"Antes",data:o,backgroundColor:"rgba(75, 135, 203, 1)",borderColor:"rgba(75, 135, 203, 1)",borderWidth:1},{label:"Depois",data:r,backgroundColor:"rgba(95, 160, 55, 1)",borderColor:"rgba(95, 160, 55, 1)",borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,max:c,callback:function(a,e,o){return a.toFixed(0)+" €"}}}],xAxes:[{ticks:{autoSkip:!1,maxRotation:90,minRotation:90}}]},title:{display:!0,text:"Custos Energéticos",fontSize:16,fontColor:"#0099cc"},legend:{onClick:function(a,e){}}}});if(l)new Chart(e,{type:"bar",data:{datasets:[{label:"Energia Solar",data:t,backgroundColor:"rgba(95, 160, 55, 1)",borderColor:"rgba(95, 160, 55, 1)"},{label:"Energia de Apoio",data:i,backgroundColor:"rgba(209, 95, 35, 1)",borderColor:"rgba(209, 95, 35, 1)"},{label:"Excedente",data:n,backgroundColor:"rgba(252, 203, 61, 1)",borderColor:"rgba(252, 203, 61, 1)"},{label:"Necessidades",data:s,backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(75, 135, 203, 1)",pointBackgroundColor:"rgba(0,0,0,0)",pointBorderColor:"rgba(0,0,0,0)",type:"line"}],labels:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,max:m,callback:function(a,e,o){return a.toFixed(0)+" kWh"}}}],xAxes:[{ticks:{autoSkip:!1,maxRotation:90,minRotation:90},stacked:!0}]},title:{display:!0,text:"Balanço Energético (kWh)",fontSize:16,fontColor:"#0099cc"},legend:{onClick:function(a,e){},labels:{useLineStyle:!0}}}})}