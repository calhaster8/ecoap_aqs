function getCustomizedPerfilMensal(e,a){return e>=0&&e<3?a>=4&&a<9?0==e?1:2==e?1:1==e?perfil_mensal[e].consumo:0:0==e?1:2==e?perfil_mensal[e].consumo:1==e?1:0:new Number($("#perfil-mensal-input"+(a+1)).val())/100}function getCustomizedPerfilSemanal(e){var a=0;if(3==e){var o=0;for(k=1;k<8;k++)o+=new Number($("#perfil-semanal-input"+k).val());a=o/7/100}return a}function totalNecessidadesEnergiaFunction(){var e=new Number($("#perfil-mensal").val()),a=new Number($("#perfil-semanal").val()),o=(new Number($("#temp-req").val()),new Number($("#distrito").val())),r=$("#consumo-energia").val(),t=$("#sis-prod").val();necessidades_mes=[],totalNecessidadesEnergia=0,total=0;var n=$("#conhece-consumo").val();if(""!=n&&null!=n&&0==n&&0==r)for(i=0;i<meses_numero_horas.length;i++)necessidades_mes[i]=new Number($("input[name='consumoAnualTotal']").val()*meses_numero_horas[i].aqs_mensal*tecnologia_atual[t].fator_conversao),totalNecessidadesEnergia+=new Number(necessidades_mes[i]);else if(""!=n&&null!=n&&0==n&&1==r)for(i=0;i<meses_numero_horas.length;i++)necessidades_mes[i]=new Number($("input[name='consumosMeses["+i+"]']").val()*tecnologia_atual[t].fator_conversao),totalNecessidadesEnergia+=new Number(necessidades_mes[i]);else if(""!=n&&null!=n&&1==n){var s=0;for(j=1;j<rowId+1;j++){var l=new Number($("#tipo-consumo-value"+j).val()),c=$("#tipo-consumo"+j).val();s+=l*consumo_diario_agua[c].valor}for(i=0;i<meses_numero_horas.length;i++)necessidades_mes[i]=s*getCustomizedPerfilMensal(e,i)*(0==a?perfil_semanal[a].valor:1==a?perfil_semanal[a].valor:3==a?new Number(getCustomizedPerfilSemanal(a)/7):1)*meses_numero_horas[i].n_dias*(temperatura_utilizacao-irradiacao_temp_amb_temp_agua[o].mesI[i].valorTempAgua)*fatores_conversao[0],totalNecessidadesEnergia+=necessidades_mes[i]}total=totalNecessidadesEnergia,correcaoOrientacao(),energiaSolarCaptada()}function correcaoOrientacao(){var e=$("#orientacao-solar").val(),a=0,o=0;""!=(o=""!=e&&null!=e&&e<0?-1*e:e)&&null!=o&&(a=o>70?0:o>0?1.14-.0085*e:1),totalCorrecaoOrientacao=a}function getCorrecaoInclinacao(e,a){for(j=0;j<correcao_inclinacao.length;j++)if(e==correcao_inclinacao[j].latitude)return correcao_inclinacao[j].meses[a].valor}function energiaSolarCaptada(){var e=new Number($("#distrito").val()),a=new Number($("#distrito-latitude").val());for(totalEnergiaArray=[],totalEnergia=0,i=0;i<meses_numero_horas.length;i++)totalEnergiaArray[i]=(rendimento_otico*perdas[1].valor-coeficient_perdas*((temperatura_utilizacao-(irradiacao_temp_amb_temp_agua[e].mesI[i].valorTempAmb+irradiacao_temp_amb_temp_agua[e].mesI[i].valorTempAgua))/(getCorrecaoInclinacao(a,i)*(totalCorrecaoOrientacao*perdas[2].valor*irradiacao_temp_amb_temp_agua[e].mesI[i].valorIrr)*(1e3*fatores_conversao[1]/meses_numero_horas[i].n_horas_sol))))*(getCorrecaoInclinacao(a,i)*(totalCorrecaoOrientacao*perdas[2].valor*irradiacao_temp_amb_temp_agua[e].mesI[i].valorIrr))*(1-perdas[0].valor)*meses_numero_horas[i].n_dias,totalEnergia+=totalEnergiaArray[i];racio(),energiaSolarCaptada2(),energiaSolarUtilizada(),energiaSolarUtilizadaPercent(),energiaBackup(),energiaBackupPercent(),excedenteSolar(),excedenteSolarPerc(),necessidadesEnergeticaskWh(),cenarioI(),cenarioF(),reduction(),1==resume()&&nextStep()}function racio(){totalRacio=new Number(media(necessidades_mes)/media(totalEnergiaArray))}function media(e){var a=0;for(i=0;i<e.length;i++)i>=4&&i<9&&(a+=new Number(e[i]));return a/5}function energiaSolarCaptada2(){var e=""==$("#corrige-coletores").val()||null==$("#corrige-coletores").val()?0==new Number(totalRacio/area_coletor_solar)?1:new Number(totalRacio/area_coletor_solar).toFixed(0):$("#corrige-coletores").val(),a=""!=$("#corrige-coletores").val()&&null!=$("#corrige-coletores").val()?$("#corrige-coletores").val():e;for(totalEnergiaArray2=[],totalEnergia2=0,i=0;i<meses_numero_horas.length;i++)totalEnergiaArray2[i]=totalEnergiaArray[i]*a*2.25,totalEnergia2+=totalEnergiaArray2[i]}function energiaSolarUtilizada(){for(totalEnergiaSolarUtilizada=[],totalEnergiaSolar=0,i=0;i<meses_numero_horas.length;i++)totalEnergiaArray2[i]>necessidades_mes[i]?totalEnergiaSolarUtilizada[i]=necessidades_mes[i]:totalEnergiaSolarUtilizada[i]=totalEnergiaArray2[i],totalEnergiaSolar+=totalEnergiaSolarUtilizada[i]}function energiaSolarUtilizadaPercent(){for(totalEnergiaSolarUtilizadaPerc=[],totalEnergiaSolarPerc=0,i=0;i<meses_numero_horas.length;i++)totalEnergiaSolarUtilizadaPerc[i]=totalEnergiaSolarUtilizada[i]/necessidades_mes[i];totalEnergiaSolarPerc=totalEnergiaSolar/total}function energiaBackup(){var e=$("#nova-fonte").val(),a=""!=$("#rendimento-medidas").val()&&$("#rendimento-medidas").val()>0?$("#rendimento-medidas").val():tecnologia_futura[e].rendimento;for(totalEnergiaBackupMes=[],totalEnergiaBackup=0,i=0;i<meses_numero_horas.length;i++)necessidades_mes[i]-totalEnergiaArray2[i]<0?totalEnergiaBackupMes[i]=0:totalEnergiaBackupMes[i]=(necessidades_mes[i]-totalEnergiaArray2[i])/(a/100),totalEnergiaBackup+=totalEnergiaBackupMes[i]}function energiaBackupPercent(){for(totalEnergiaBackupMesPerc=[],totalEnergiaBackupPerc=0,i=0;i<meses_numero_horas.length;i++)totalEnergiaBackupMesPerc[i]=totalEnergiaBackupMes[i]/necessidades_mes[i];totalEnergiaBackupPerc=totalEnergiaBackup/total}function excedenteSolar(){for(totalExcedenteSolarArray=[],totalExcedenteSolar=0,i=0;i<meses_numero_horas.length;i++)totalExcedenteSolarArray[i]=totalEnergiaArray2[i]-totalEnergiaSolarUtilizada[i],totalExcedenteSolar+=totalExcedenteSolarArray[i]}function excedenteSolarPerc(){for(totalExcedenteSolarArrayPerc=[],totalExcedenteSolarPerc=0,i=0;i<meses_numero_horas.length;i++)totalExcedenteSolarArrayPerc[i]=totalExcedenteSolarArray[i]/totalEnergiaArray2[i];totalExcedenteSolarPerc=totalExcedenteSolar/totalEnergia2}function necessidadesEnergeticaskWh(){necessidades_mes_kWh=[],total_mes_kWh=0;var e=$("#conhece-consumo").val(),a=$("#consumo-energia").val();for(i=0;i<meses_numero_horas.length;i++)necessidades_mes_kWh[i]=0==e&&1==a?$("input[name='consumosMeses["+i+"]']").val()*tecnologia_atual[$("#sis-prod").val()].fator_conversao:0==e&&0==a?$("input[name='consumoAnualTotal']").val()*tecnologia_atual[$("#sis-prod").val()].fator_conversao*meses_numero_horas[i].aqs_mensal:necessidades_mes[i]*fatores_conversao[1],total_mes_kWh+=necessidades_mes_kWh[i]}function cenarioI(){var e=$("#sis-prod").val(),a=2==$("#rend").val()?0==e?$("#iRendMan").val():$("#iRendMan").val()/100:$("#rend").val(),o=$("#age").val(),r=$("#custo-unit-input").val(),t=$("#conhece-consumo").val(),n=$("#consumo-energia").val(),s=0;for(cenarioI_mes=[],cenarioI_custos=[],total_cenarioI_mes=0,total_cenarioI_custos=0,i=0;i<meses_numero_horas.length;i++)s=0==t&&1==n?$("input[name='consumosMeses["+i+"]']").val()*tecnologia_atual[$("#sis-prod").val()].fator_conversao:0==t&&0==n?$("input[name='consumoAnualTotal']").val()*tecnologia_atual[$("#sis-prod").val()].fator_conversao*meses_numero_horas[i].aqs_mensal:0==a&&tecnologia_atual[e].rendimento[o].nome==idades[o]?necessidades_mes_kWh[i]/tecnologia_atual[e].rendimento[o].valor:necessidades_mes_kWh[i]/a,cenarioI_mes[i]=s,cenarioI_custos[i]=cenarioI_mes[i]*r/tecnologia_atual[e].fator_conversao,total_cenarioI_mes+=cenarioI_mes[i],total_cenarioI_custos+=cenarioI_custos[i];total_cenarioI_custos=total_cenarioI_custos}function cenarioF(){var e=$("#sis-prod").val(),a=2==$("#rend").val()?0==e?$("#iRendMan").val():$("#iRendMan").val()/100:$("#rend").val(),o=$("#nova-fonte").val(),r=""!=$("#rendimento-medidas").val()&&$("#rendimento-medidas").val()>0?$("#rendimento-medidas").val():tecnologia_futura[o].rendimento,t=$("#age").val(),n=$("#custo-unit-medidas").val(),s=0;cenarioF_mes=[],total_cenarioF_mes=0,cenarioF_custos=[],total_cenarioF_custos=0;var l=0!=a&&""!=a&&a>0&&(""==t||null==t)?a:tecnologia_atual[e].rendimento[t].valor;for(i=0;i<meses_numero_horas.length;i++)s=0==$("#nova-fonte").val()?isNaN(1==$("#acoplar-solar").val()||""==$("#acoplar-solar").val()||null==$("#acoplar-solar").val()?cenarioI_mes[i]*l/r:totalEnergiaBackupMes[i]*fatores_conversao[1]/r)?0:1==$("#acoplar-solar").val()||""==$("#acoplar-solar").val()||null==$("#acoplar-solar").val()?cenarioI_mes[i]*l/r:totalEnergiaBackupMes[i]*fatores_conversao[1]:isNaN(1==$("#acoplar-solar").val()||""==$("#acoplar-solar").val()||null==$("#acoplar-solar").val()?cenarioI_mes[i]*l/(r/100):totalEnergiaBackupMes[i]*fatores_conversao[1]/(r/100))?0:1==$("#acoplar-solar").val()||""==$("#acoplar-solar").val()||null==$("#acoplar-solar").val()?cenarioI_mes[i]*l/(r/100):totalEnergiaBackupMes[i]*fatores_conversao[1],cenarioF_mes[i]=s,total_cenarioF_mes+=cenarioF_mes[i],cenarioF_custos[i]=cenarioF_mes[i]*n/tecnologia_futura[o].fator_conversao,total_cenarioF_custos+=cenarioF_custos[i];total_cenarioF_custos=total_cenarioF_custos}function reduction(){for(reducao_mes=[],total_reducao_mes=0,reducao_consumos=[],total_reducao_consumos=0,i=0;i<meses_numero_horas.length;i++)reducao_mes[i]=cenarioI_custos[i]-cenarioF_custos[i],total_reducao_mes+=reducao_mes[i],reducao_consumos[i]=cenarioI_mes[i]-cenarioF_mes[i],total_reducao_consumos+=reducao_consumos[i]}function resume(){var e,a,o,r,t,i=0,n=0,s=0,l=0,c=0,m=0,u=0,d=0,_=0,v=0,g=0,p=0,h=0,f=$("#nova-fonte").val(),b=$("#corrige-coletores").val(),E=""!=$("#rendimento-medidas").val()&&$("#rendimento-medidas").val()>0?$("#rendimento-medidas").val():tecnologia_futura[f].rendimento;if(1==$("#acoplar-solar").val()&&""!=$("#acoplar-solar").val()&&null!=$("#acoplar-solar").val()?($(".solar-termico-results").attr("style","display:none"),$(".nota-acoplar").html("*O investimento estimado incorpora os custos com equipamentos/tecnologia, com depósitos e/ou acessórios e os respetivos custos de instalação.").show()):($(".solar-termico-results").removeAttr("style"),$(".nota-acoplar").html("*O investimento estimado incorpora os custos com o sistema solar térmico, com equipamentos/tecnologia, com depósitos e/ou acessórios e os respetivos custos de instalação.").show()),i=total_cenarioI_mes,e=total_cenarioI_custos,a=totalEnergiaSolarPerc,n=total_cenarioF_mes,o=total_cenarioF_custos,(s=total_cenarioI_custos-total_cenarioF_custos)<0?($("#errorAQS").html("A implementação da medida selecionada resultará num aumento da fatura energética face à situação actual."),$("#errorAQS").show()):0==s?($("#errorAQS").html("A implementação da medida selecionada não resultará em nenhuma alteração na fatura energética atual."),$("#errorAQS").show()):($("#errorAQS").html(""),$("#errorAQS").hide()),r=s/total_cenarioI_custos,(l=null!=b&&""!=b?new Number(b):new Number((totalRacio/area_coletor_solar).toFixed(0)))<avisos[4].valor)return alert(avisos[4].mensagem),0;c=null==b||""==b?new Number((l*area_coletor_solar).toFixed(0)):new Number((b*area_coletor_solar).toFixed(0));var x=max(necessidades_mes_kWh);t=arred(necessidades_mes_kWh[0]/fatores_conversao[0]/fatores_conversao[1]/meses_numero_horas[x].n_dias/($("#temp-req").val()-temperatura_media),-2),u=c<10?c*investimento[0].info[0].valor:c>100?c*investimento[0].info[2].valor:investimento[0].info[1].valor*c,d=maxValor(cenarioF_mes)/(E/100)/meses_numero_horas[max(cenarioF_mes)].n_dias/2*tecnologia_futura[f].investimento;var S=t<500?t*investimento[1].info[0].valor:t>2e3?t*investimento[1].info[2].valor:t*investimento[1].info[1].valor;return _=$("#sis-prod").val()>=5&&$("#sis-prod").val()<8?S:S/2,v=0==$("#acoplar-solar").val()?(u+d+_)*investimento[2].valor_direto:(d+_)*investimento[2].valor_direto,g=(m=0==$("#acoplar-solar").val()&&""!=$("#acoplar-solar").val()&&null!=$("#acoplar-solar").val()?u+d+_+v:d+_+v)*investimento[3].valor_direto,p=m/s,h=100*maxValor(totalExcedenteSolarArrayPerc),$("#consumoCI").html(i.toFixed(0)+" kWh"),$("#custosCI").html(new Number(e).toFixed(0)+" €"),$("#consumosCF").html(n.toFixed(0)+" kWh"),$("#custosCF").html(new Number(o).toFixed(0)+" €"),$("#contributoSolarTermico").html(new Number(100*a).toFixed(0)+"%"),$("#reducaoValor").html(s.toFixed(0)+" €"),$("#reducaoPercent").html(new Number(100*r).toFixed(0)+"%"),$("#totalExcedenteSolarPerc").html(h.toFixed(0)+"%"),$("#numeroColetores").html(l.toFixed(0)),$("#areaColetores").html(c.toFixed(0)+" m2"),$("#vAcumulacao").html(new Number(t).toFixed(0)+" litros"),$("#investimentoTotal").html(m.toFixed(0)+" €"),$("#custosColectores").html(u.toFixed(0)+" €"),$("#custosEquipamento").html(d.toFixed(0)+" €"),$("#custosDepositos").html(_.toFixed(0)+" €"),$("#custosInstalacao").html(v.toFixed(0)+" €"),$("#custosOpManutencao").html(g.toFixed(0)+" €"),p<0?$("#periodoRetorno").html("-"):$("#periodoRetorno").html(p.toFixed(1)+" anos"),h>40&&null!=h&&""!=h&&l>=1.5?($(".excedente-note").html(avisos[0].mensagem),$(".excedente-note").show()):($(".excedente-note").html(""),$(".excedente-note").hide()),chartData(),1}function max(e){var a=0,o=0;for(i=0;i<e.length;i++)new Number(e[i])>new Number(a)&&(a=e[i],o=i);return o}function maxValor(e){var a=0;for(i=0;i<e.length;i++)new Number(e[i])>new Number(a)&&(a=e[i]);return a}function arred(e,a){var o=0;return-1==a?o=10*Math.round(e/10):-2==a?o=100*Math.round(e/100):-3==a?o=1e3*Math.round(e/1e3):-4==a&&(o=1e4*Math.round(e/1e4)),o}function maxChart(e){var a=0;if(e.length>0)for(var o=0;o<e.length;o++)(e[o]>a||0==a)&&(a=e[o]);return a}function chartData(){document.getElementById("varCustos").getContext("2d");var e=document.getElementById("solarTermC").getContext("2d"),a=maxChart(cenarioI_custos)>maxChart(cenarioF_custos)?maxChart(cenarioI_custos):maxChart(cenarioF_custos),o=maxChart(necessidades_mes)>maxChart(totalExcedenteSolarArray)?maxChart(necessidades_mes):maxChart(totalExcedenteSolarArray)>maxChart(energiaSolarUtilizada)?maxChart(totalExcedenteSolarArray):maxChart(energiaSolarUtilizada);new Chart(varCustos,{type:"bar",data:{labels:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],datasets:[{label:"Antes",data:cenarioI_custos,backgroundColor:"rgba(75, 135, 203, 1)",borderColor:"rgba(75, 135, 203, 1)",borderWidth:1},{label:"Depois",data:cenarioF_custos,backgroundColor:"rgba(95, 160, 55, 1)",borderColor:"rgba(95, 160, 55, 1)",borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,max:a+40}}]}}}),new Chart(e,{type:"bar",data:{datasets:[{label:"Energia Solar",data:totalEnergiaSolarUtilizada,backgroundColor:"rgba(95, 160, 55, 1)",borderColor:"rgba(95, 160, 55, 1)"},{label:"Energia de Apoio",data:totalEnergiaBackupMes,backgroundColor:"rgba(209, 95, 35, 1)",borderColor:"rgba(209, 95, 35, 1)"},{label:"Excedente",data:totalExcedenteSolarArray,backgroundColor:"rgba(252, 203, 61, 1)",borderColor:"rgba(252, 203, 61, 1)"},{label:"Necessidades",data:necessidades_mes,backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(75, 135, 203, 1)",pointBackgroundColor:"rgba(0,0,0,0)",pointBorderColor:"rgba(0,0,0,0)",type:"line"}],labels:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,max:o+50}}]}}})}